{% if reverse_tcp or reverse_udp %}
stream {
{% for service in reverse_tcp %}
    upstream tcp_upstream_{{ loop.index }} {
    {% for server in service.backends %}
        server {{ server }};
    {% endfor %}
    }

    server {
        listen {{ service.listen_port }};
        proxy_pass tcp_upstream_{{ loop.index }};
    }
{% endfor %}

{% for service in reverse_udp %}
    upstream udp_upstream_{{ loop.index }} {
    {% for server in service.backends %}
        server {{ server }};
    {% endfor %}
    }

    server {
        listen {{ service.listen_port }} udp;
        proxy_pass udp_upstream_{{ loop.index }};
    }
{% endfor %}
}
{% endif %}
